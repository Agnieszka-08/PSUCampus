import{r as x,j as u,a as ct}from"./app-Cqxp1_7P.js";import{W as te,l as ee}from"./ModelLoader-Bj-44Cu6.js";import{C as oe,a as M,M as rt,T as at,Q as Lt,b as At,V as B,c as se,P as ie,d as ne,e as ae,f as re,A as le,D as he,R as ce,B as st,S as yt,G as Ot,g as kt,h as It,i as Nt}from"./three.core-BXuiQTOK.js";import{setupRaycaster as de}from"./RaycasterManager-DpyK2-wN.js";import{flyToTargetSafe as ue,flyToMeshSafe as Ft}from"./ControlsManager-DOTcoOXg.js";import{M as pe,I as me}from"./InfoPopup-D9ZMzKhJ.js";const Gt={type:"change"},wt={type:"start"},Bt={type:"end"},mt=new se,Ut=new ie,fe=Math.cos(70*ne.DEG2RAD),E=new M,L=2*Math.PI,p={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},bt=1e-6;class _e extends oe{constructor(t,o=null){super(t,o),this.state=p.NONE,this.target=new M,this.cursor=new M,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:rt.ROTATE,MIDDLE:rt.DOLLY,RIGHT:rt.PAN},this.touches={ONE:at.ROTATE,TWO:at.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new M,this._lastQuaternion=new Lt,this._lastTargetPosition=new M,this._quat=new Lt().setFromUnitVectors(t.up,new M(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new At,this._sphericalDelta=new At,this._scale=1,this._panOffset=new M,this._rotateStart=new B,this._rotateEnd=new B,this._rotateDelta=new B,this._panStart=new B,this._panEnd=new B,this._panDelta=new B,this._dollyStart=new B,this._dollyEnd=new B,this._dollyDelta=new B,this._dollyDirection=new M,this._mouse=new B,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=ye.bind(this),this._onPointerDown=ge.bind(this),this._onPointerUp=be.bind(this),this._onContextMenu=Se.bind(this),this._onMouseWheel=Ee.bind(this),this._onKeyDown=De.bind(this),this._onTouchStart=Me.bind(this),this._onTouchMove=Pe.bind(this),this._onMouseDown=we.bind(this),this._onMouseMove=xe.bind(this),this._interceptControlDown=Te.bind(this),this._interceptControlUp=Re.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(t){super.connect(t),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(t){t.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=t}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(Gt),this.update(),this.state=p.NONE}update(t=null){const o=this.object.position;E.copy(o).sub(this.target),E.applyQuaternion(this._quat),this._spherical.setFromVector3(E),this.autoRotate&&this.state===p.NONE&&this._rotateLeft(this._getAutoRotationAngle(t)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,c=this.maxAzimuthAngle;isFinite(n)&&isFinite(c)&&(n<-Math.PI?n+=L:n>Math.PI&&(n-=L),c<-Math.PI?c+=L:c>Math.PI&&(c-=L),n<=c?this._spherical.theta=Math.max(n,Math.min(c,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(n+c)/2?Math.max(n,this._spherical.theta):Math.min(c,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let _=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const v=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),_=v!=this._spherical.radius}if(E.setFromSpherical(this._spherical),E.applyQuaternion(this._quatInverse),o.copy(this.target).add(E),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let v=null;if(this.object.isPerspectiveCamera){const Y=E.length();v=this._clampDistance(Y*this._scale);const it=Y-v;this.object.position.addScaledVector(this._dollyDirection,it),this.object.updateMatrixWorld(),_=!!it}else if(this.object.isOrthographicCamera){const Y=new M(this._mouse.x,this._mouse.y,0);Y.unproject(this.object);const it=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),_=it!==this.object.zoom;const dt=new M(this._mouse.x,this._mouse.y,0);dt.unproject(this.object),this.object.position.sub(dt).add(Y),this.object.updateMatrixWorld(),v=E.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;v!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(v).add(this.object.position):(mt.origin.copy(this.object.position),mt.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(mt.direction))<fe?this.object.lookAt(this.target):(Ut.setFromNormalAndCoplanarPoint(this.object.up,this.target),mt.intersectPlane(Ut,this.target))))}else if(this.object.isOrthographicCamera){const v=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),v!==this.object.zoom&&(this.object.updateProjectionMatrix(),_=!0)}return this._scale=1,this._performCursorZoom=!1,_||this._lastPosition.distanceToSquared(this.object.position)>bt||8*(1-this._lastQuaternion.dot(this.object.quaternion))>bt||this._lastTargetPosition.distanceToSquared(this.target)>bt?(this.dispatchEvent(Gt),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(t){return t!==null?L/60*this.autoRotateSpeed*t:L/60/60*this.autoRotateSpeed}_getZoomScale(t){const o=Math.abs(t*.01);return Math.pow(.95,this.zoomSpeed*o)}_rotateLeft(t){this._sphericalDelta.theta-=t}_rotateUp(t){this._sphericalDelta.phi-=t}_panLeft(t,o){E.setFromMatrixColumn(o,0),E.multiplyScalar(-t),this._panOffset.add(E)}_panUp(t,o){this.screenSpacePanning===!0?E.setFromMatrixColumn(o,1):(E.setFromMatrixColumn(o,0),E.crossVectors(this.object.up,E)),E.multiplyScalar(t),this._panOffset.add(E)}_pan(t,o){const n=this.domElement;if(this.object.isPerspectiveCamera){const c=this.object.position;E.copy(c).sub(this.target);let _=E.length();_*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*t*_/n.clientHeight,this.object.matrix),this._panUp(2*o*_/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(t*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(o*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(t,o){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),c=t-n.left,_=o-n.top,v=n.width,Y=n.height;this._mouse.x=c/v*2-1,this._mouse.y=-(_/Y)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(t){return Math.max(this.minDistance,Math.min(this.maxDistance,t))}_handleMouseDownRotate(t){this._rotateStart.set(t.clientX,t.clientY)}_handleMouseDownDolly(t){this._updateZoomParameters(t.clientX,t.clientX),this._dollyStart.set(t.clientX,t.clientY)}_handleMouseDownPan(t){this._panStart.set(t.clientX,t.clientY)}_handleMouseMoveRotate(t){this._rotateEnd.set(t.clientX,t.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const o=this.domElement;this._rotateLeft(L*this._rotateDelta.x/o.clientHeight),this._rotateUp(L*this._rotateDelta.y/o.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(t){this._dollyEnd.set(t.clientX,t.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(t){this._panEnd.set(t.clientX,t.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(t){this._updateZoomParameters(t.clientX,t.clientY),t.deltaY<0?this._dollyIn(this._getZoomScale(t.deltaY)):t.deltaY>0&&this._dollyOut(this._getZoomScale(t.deltaY)),this.update()}_handleKeyDown(t){let o=!1;switch(t.code){case this.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(L*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),o=!0;break;case this.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(-L*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),o=!0;break;case this.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(L*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),o=!0;break;case this.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(-L*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),o=!0;break}o&&(t.preventDefault(),this.update())}_handleTouchStartRotate(t){if(this._pointers.length===1)this._rotateStart.set(t.pageX,t.pageY);else{const o=this._getSecondPointerPosition(t),n=.5*(t.pageX+o.x),c=.5*(t.pageY+o.y);this._rotateStart.set(n,c)}}_handleTouchStartPan(t){if(this._pointers.length===1)this._panStart.set(t.pageX,t.pageY);else{const o=this._getSecondPointerPosition(t),n=.5*(t.pageX+o.x),c=.5*(t.pageY+o.y);this._panStart.set(n,c)}}_handleTouchStartDolly(t){const o=this._getSecondPointerPosition(t),n=t.pageX-o.x,c=t.pageY-o.y,_=Math.sqrt(n*n+c*c);this._dollyStart.set(0,_)}_handleTouchStartDollyPan(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enablePan&&this._handleTouchStartPan(t)}_handleTouchStartDollyRotate(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enableRotate&&this._handleTouchStartRotate(t)}_handleTouchMoveRotate(t){if(this._pointers.length==1)this._rotateEnd.set(t.pageX,t.pageY);else{const n=this._getSecondPointerPosition(t),c=.5*(t.pageX+n.x),_=.5*(t.pageY+n.y);this._rotateEnd.set(c,_)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const o=this.domElement;this._rotateLeft(L*this._rotateDelta.x/o.clientHeight),this._rotateUp(L*this._rotateDelta.y/o.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(t){if(this._pointers.length===1)this._panEnd.set(t.pageX,t.pageY);else{const o=this._getSecondPointerPosition(t),n=.5*(t.pageX+o.x),c=.5*(t.pageY+o.y);this._panEnd.set(n,c)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(t){const o=this._getSecondPointerPosition(t),n=t.pageX-o.x,c=t.pageY-o.y,_=Math.sqrt(n*n+c*c);this._dollyEnd.set(0,_),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const v=(t.pageX+o.x)*.5,Y=(t.pageY+o.y)*.5;this._updateZoomParameters(v,Y)}_handleTouchMoveDollyPan(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enablePan&&this._handleTouchMovePan(t)}_handleTouchMoveDollyRotate(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enableRotate&&this._handleTouchMoveRotate(t)}_addPointer(t){this._pointers.push(t.pointerId)}_removePointer(t){delete this._pointerPositions[t.pointerId];for(let o=0;o<this._pointers.length;o++)if(this._pointers[o]==t.pointerId){this._pointers.splice(o,1);return}}_isTrackingPointer(t){for(let o=0;o<this._pointers.length;o++)if(this._pointers[o]==t.pointerId)return!0;return!1}_trackPointer(t){let o=this._pointerPositions[t.pointerId];o===void 0&&(o=new B,this._pointerPositions[t.pointerId]=o),o.set(t.pageX,t.pageY)}_getSecondPointerPosition(t){const o=t.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[o]}_customWheelEvent(t){const o=t.deltaMode,n={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(o){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100;break}return t.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function ge(s){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(s.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(s)&&(this._addPointer(s),s.pointerType==="touch"?this._onTouchStart(s):this._onMouseDown(s)))}function ye(s){this.enabled!==!1&&(s.pointerType==="touch"?this._onTouchMove(s):this._onMouseMove(s))}function be(s){switch(this._removePointer(s),this._pointers.length){case 0:this.domElement.releasePointerCapture(s.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(Bt),this.state=p.NONE;break;case 1:const t=this._pointers[0],o=this._pointerPositions[t];this._onTouchStart({pointerId:t,pageX:o.x,pageY:o.y});break}}function we(s){let t;switch(s.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case rt.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(s),this.state=p.DOLLY;break;case rt.ROTATE:if(s.ctrlKey||s.metaKey||s.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(s),this.state=p.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(s),this.state=p.ROTATE}break;case rt.PAN:if(s.ctrlKey||s.metaKey||s.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(s),this.state=p.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(s),this.state=p.PAN}break;default:this.state=p.NONE}this.state!==p.NONE&&this.dispatchEvent(wt)}function xe(s){switch(this.state){case p.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(s);break;case p.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(s);break;case p.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(s);break}}function Ee(s){this.enabled===!1||this.enableZoom===!1||this.state!==p.NONE||(s.preventDefault(),this.dispatchEvent(wt),this._handleMouseWheel(this._customWheelEvent(s)),this.dispatchEvent(Bt))}function De(s){this.enabled!==!1&&this._handleKeyDown(s)}function Me(s){switch(this._trackPointer(s),this._pointers.length){case 1:switch(this.touches.ONE){case at.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(s),this.state=p.TOUCH_ROTATE;break;case at.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(s),this.state=p.TOUCH_PAN;break;default:this.state=p.NONE}break;case 2:switch(this.touches.TWO){case at.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(s),this.state=p.TOUCH_DOLLY_PAN;break;case at.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(s),this.state=p.TOUCH_DOLLY_ROTATE;break;default:this.state=p.NONE}break;default:this.state=p.NONE}this.state!==p.NONE&&this.dispatchEvent(wt)}function Pe(s){switch(this._trackPointer(s),this.state){case p.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(s),this.update();break;case p.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(s),this.update();break;case p.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(s),this.update();break;case p.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(s),this.update();break;default:this.state=p.NONE}}function Se(s){this.enabled!==!1&&s.preventDefault()}function Te(s){s.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function Re(s){s.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const ve={"3DGeom-1078":{name:"Information Technology Building",department:"College of Information Technology",description:"This building houses computer labs, lecture rooms, and faculty offices for the IT Department."}};function Ne(){const s=x.useRef(null),t=x.useRef(null),o=x.useRef(null),n=x.useRef(null),c=x.useRef(null),_=x.useRef([]),v=x.useRef(null),[Y,it]=x.useState([]),[dt,nt]=x.useState(null),[H,ut]=x.useState(null),[xt,Yt]=x.useState([]),[zt,$t]=x.useState({}),Et=x.useRef(document.body.style.background),Dt=x.useRef(document.body.style.overflow),Mt={"3DGeom-5559":"arts_science","3DGeom-10191":"administrative","3DGeom-5890":"education","3DGeom-5891":"education","3DGeom-9084":"sac","3DGeom-4166":"cayetano","3DGeom-4179":"cayetano","3DGeom-4173":"cayetano","3DGeom-3337":"audiovisual","3DGeom-3332":"audiovisual","3DGeom-4309":"agri","3DGeom-4308":"agri","3DGeom-6523":"cc","3DGeom-6071":"cc","3DGeom-6255":"cc","3DGeom-1104":"academic","3DGeom-3177":"twinbldg","3DGeom-9669":"hm_lb","3DGeom-5597":"admin"},ft={"3DGeom-5559":"Arts and Science Building","3DGeom-10191":"Administrative Building","3DGeom-5890":"Education Building","3DGeom-5891":"Education Building","3DGeom-9084":"Student Activity Center","3DGeom-4166":"Cayetano Building","3DGeom-4179":"Cayetano Building","3DGeom-4173":"Cayetano Building","3DGeom-3337":"Audio Visual Building","3DGeom-3332":"Audio Visual Building","3DGeom-4309":"Agriculture Building","3DGeom-4308":"Agriculture Building","3DGeom-6523":"Covered Court","3DGeom-6071":"Covered Court","3DGeom-6255":"Covered Court","3DGeom-1104":"Academic Building","3DGeom-3177":"Twin Building","3DGeom-9669":"HM Lab Building","3DGeom-5597":"General Update"},_t=()=>typeof window<"u"?window.innerWidth<768:!1,[d,Ht]=x.useState(_t),[Pt,pt]=x.useState(()=>!_t());x.useEffect(()=>{if(typeof window>"u")return;const e=()=>Ht(_t());return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),x.useEffect(()=>{pt(!d)},[d]);const St=async(e,r,D,m=null)=>{try{const[i,a,R,P,h]=await Promise.all([ct.get(`/info-building/${e}`),ct.get(`/happenings/${e}`),ct.get(`/services/${e}`),ct.get(`/achievements/${e}`),ct.get(`/announcements/${e}`)]),F=Array.isArray(i.data)?i.data:i.data?[i.data]:[],W=Array.isArray(a.data)?a.data:a.data?[a.data]:[],Q=Array.isArray(R.data)?R.data:R.data?[R.data]:[],Z=Array.isArray(P.data)?P.data:P.data?[P.data]:[],J=Array.isArray(h.data)?h.data:h.data?[h.data]:[],y=F,K=W,lt=Q,vt=Z,Ct=J;ut({id:e,name:y.name||m?.name||e.toUpperCase(),department:e.toUpperCase(),happenings:K,services:lt,achievements:vt,announcements:Ct,infoDetails:y,infoCount:F.length,happCount:W.length,serviceCount:Q.length,achievementCount:Z.length,announcementCount:J.length,x:r,y:D,_rawInfo:F,_rawHappenings:W,_rawServices:Q,_rawAchievements:Z,_rawAnnouncements:J})}catch(i){console.error("Error fetching popup data:",i)}};function Wt(e,r=256,D=256){const m=document.createElement("canvas");m.width=r,m.height=D;const i=m.getContext("2d");i.clearRect(0,0,r,D);const a=new Nt(m),R=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),P=URL.createObjectURL(R),h=new Image;return h.onload=()=>{i.clearRect(0,0,r,D),i.drawImage(h,0,0,r,D),a.needsUpdate=!0,URL.revokeObjectURL(P)},h.onerror=()=>{a.needsUpdate=!0,URL.revokeObjectURL(P)},h.src=P,a}function Zt(e=256,r="#ce1319ff",D=""){const m=(D||"").split(/\s+/).filter(Boolean),i=[];let a="";for(let y of m)a?(a+" "+y).length>12&&i.length<2?(i.push(a),a=y):a=a?a+" "+y:y:a=y;for(a&&i.push(a);i.length<1;)i.push("");const R=Math.round(e/2),P=Math.round(e*.36),h=Math.round(e*.14),F=Math.round(P+h*2.2),W=y=>String(y).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"),Q=Math.round(e*.09),Z=Math.round(e*.11),J=`
<svg xmlns="http://www.w3.org/2000/svg" width="${e}" height="${e}" viewBox="0 0 ${e} ${e}">
  <defs>
    <linearGradient id="g" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0" stop-color="${r}" stop-opacity="1"/>
      <stop offset="1" stop-color="${r}" stop-opacity="0.88"/>
    </linearGradient>
  </defs>

  <!-- soft shadow -->
  <ellipse cx="${R}" cy="${F+Math.round(e*.04)}" rx="${Math.round(h*1.25)}" ry="${Math.round(h*.6)}" fill="rgba(0,0,0,0.18)"/>

  <!-- teardrop pin (circle + pointed tail merged via path) -->
  <path d="M ${R} ${F} L ${R+h} ${P} A ${h} ${h} 0 1 0 ${R-h} ${P} Z" fill="url(#g)"/>

  <!-- subtle highlight -->
  <ellipse cx="${R-Math.round(h*.35)}" cy="${P-Math.round(h*.35)}" rx="${Math.round(h*.45)}" ry="${Math.round(h*.25)}" fill="rgba(255,255,255,0.55)"/>

  <!-- inner white center -->
  <circle cx="${R}" cy="${P}" r="${Math.round(h*.45)}" fill="#fff"/>

  <!-- label below pin (up to 3 lines) -->
  <g font-family="sans-serif" font-size="${Q}" fill="#222" text-anchor="middle">
    ${i.slice(0,3).map((y,K)=>{const lt=F+Math.round(Z*.9)+K*Z;return`<text x="${R}" y="${lt}">${W(y)}</text>`}).join("")}
  </g>
</svg>`.trim();return Wt(J,e,e)}x.useEffect(()=>{const e=s.current;if(!e)return;try{document.documentElement.style.margin="0",document.body.style.margin="0",document.documentElement.style.height="100%",document.body.style.height="100%"}catch{}e.style.position="fixed",e.style.left="0",e.style.top="0",e.style.width="100vw",e.style.height="100vh",e.style.zIndex="0",Dt.current=document.body.style.overflow,Et.current=document.body.style.background;try{document.body.style.background="linear-gradient(to bottom, #87CEEB 0%, #e0f7ff 100%)"}catch{}document.body.style.overflow="hidden";const r=new ae;r.background=null;const D=e.clientWidth,m=e.clientHeight,i=new re(45,D/m,.1,1e3);i.position.set(0,20,40),o.current=i;const a=new te({antialias:!1,alpha:!0});a.setSize(D,m),a.domElement.style.display="block",a.domElement.style.width="100%",a.domElement.style.height="100%",a.domElement.style.objectFit="cover",a.setPixelRatio(1),a.shadowMap.enabled=!1,a.setClearColor(0,0),c.current=a,e.appendChild(a.domElement);const R=new le(16777215,.8);r.add(R);const P=new he(16777215,.6);P.position.set(10,20,10),r.add(P);const h=new _e(i,a.domElement);h.enableDamping=!1,h.target.set(0,5,0),h.minPolarAngle=0,h.maxPolarAngle=Math.PI/2-.01,h.screenSpacePanning=!1,n.current=h,window.__campus_camera=i,window.__campus_controls=h;let F=!1,W=null;const Q=80;let Z=0;const J=()=>a.render(r,i);function y(){const l=performance.now(),G=Math.max(0,Q-(l-Z));F||(F=!0,W=setTimeout(()=>{F=!1,Z=performance.now(),J()},G))}window.__campus_requestRender=y,h.addEventListener("change",y);let K=null;function lt(l){function G(b=256){const j=document.createElement("canvas");j.width=b,j.height=b;const k=j.getContext("2d"),O=k.createRadialGradient(b/2,b/2,b*.05,b/2,b/2,b/2);O.addColorStop(0,"rgba(255,255,255,0.95)"),O.addColorStop(.6,"rgba(255,255,255,0.65)"),O.addColorStop(1,"rgba(255,255,255,0)"),k.fillStyle=O,k.fillRect(0,0,b,b);const f=new Nt(j);return f.needsUpdate=!0,f}K=new Ot;const tt=G(256),gt=Math.min(24,Math.max(6,Math.floor(l/8)));for(let b=0;b<gt;b++){const j=new kt({map:tt,transparent:!0,opacity:0,depthWrite:!1}),k=new It(j),O=l*1.6;k.position.set((Math.random()-.5)*O,l*(.8+Math.random()*1),(Math.random()-.5)*O);const f=l*(.25+Math.random()*.6);k.scale.set(f,f*.6,1),K.add(k)}K.position.y=0,r.add(K);let V=0;const X=60;let et=performance.now();function $(){V++;const b=Math.min(1,V/X);K.children.forEach((j,k)=>{j.material.opacity=b*(.6+k%3*.12);const O=performance.now(),f=(O-et)/1e3;j.position.x+=Math.sin(O/1e4+k)*.02*f*Math.max(10,1)}),et=performance.now(),a.render(r,i),V<X&&requestAnimationFrame($)}$()}v.current=new ce,ee("/models/psucampus.glb").then(l=>{t.current=l,r.add(l);const tt=new st().setFromObject(l).getCenter(new M);l.position.sub(tt);const X=new st().setFromObject(l).getBoundingSphere(new yt).radius||10;lt(X);const et=i.fov*Math.PI/180,$=Math.abs(X/Math.sin(et/2));i.position.set(0,X*.6+$*.05,$*1.2),i.near=Math.max(.1,$/100),i.far=$*10,i.lookAt(new M(0,0,0)),i.updateProjectionMatrix(),h.target.set(0,0,0),h.update(),_.current=[];const j=new Map;let k=1;l.traverse(f=>{if(!f.isMesh)return;const U=new st().setFromObject(f),q=new M;if(U.getSize(q),q.length()<.8)return;const S=f.userData?.buildingName,w=f.userData?.name,T=f.name&&f.name!==""?f.name:null,C=S||w||T||`Building ${k++}`;j.has(C)||j.set(C,[]),j.get(C).push(f)});const O=[];for(const[f,U]of j.entries()){const q=new st;for(const I of U){const g=new st().setFromObject(I);q.union(g)}const ht=q.getCenter(new M),w=q.getBoundingSphere(new yt).radius||Math.max(...U.map(I=>new st().setFromObject(I).getSize(new M).length()))||5,T=Math.max(1,q.getSize(new M).y*.5+1),C=f;_.current.push({id:C,name:f,meshes:U,center:ht,radius:w,offsetY:T}),O.push({id:C,name:f})}it(O),y();try{const f=new Ot;f.renderOrder=999;const U=new Map;l.traverse(S=>{if(!S.isMesh)return;const w=Mt[S.name];if(!w)return;const T=new st().setFromObject(S),I=T.getBoundingSphere(new yt).radius||T.getSize(new M).length();if(!U.has(w))U.set(w,{nodes:[S],bbox:T.clone(),bestNode:S,bestMetric:I});else{const g=U.get(w);g.nodes.push(S),g.bbox.union(T),I>g.bestMetric&&(g.bestMetric=I,g.bestNode=S)}});for(const[S,w]of U.entries()){const T=w.bbox.getCenter(new M),C=Math.max(.6,(w.bestMetric||1)*.6),I=ft[w.bestNode.name]||w.bestNode.userData?.buildingName||S,g=Zt(256,"#ff5a5f",I),ot=new kt({map:g,transparent:!0,depthTest:!1,depthWrite:!1,alphaTest:.01}),N=new It(ot);N.position.copy(T),N.position.y+=Math.max(.25,C*.6),N.scale.set(C,C,1),N.userData={isPin:!0,role:S,displayName:I,targetMesh:w.bestNode,meshes:w.nodes},N.renderOrder=1e3,N.frustumCulled=!1,f.add(N)}r.add(f);const q={hmo:"1st Floor",boa:"3rd Floor",it_dept:"2nd Floor",ced:"2nd Floor",coa:"1st Floor",gened:"1st Floor",paso:"1st Floor",guidance_office:"2nd Floor",student_services_office:"2nd Floor",supreme_student_council:"2nd Floor",clinic:"1st Floor",registrar:"1st Floor",mis:"1st Floor",administrative_office:"1st Floor",supply_office:"1st Floor",accounting_office:"1st Floor",cashier_office:"1st Floor",library_office:"2nd Floor"},ht=[];for(const[S,w]of U.entries()){const T=w.bestNode,C={id:T.name||T.uuid,role:S,displayName:ft[T.name]||T.userData?.buildingName||S,mesh:T,meshes:w.nodes,children:[]},I=w.nodes.map(g=>{const ot=g.name||g.uuid,N=explicitMeshRoleMap[ot]||inferOfficeRoleFromMesh(g,S)||null,Qt=(N?officeRoleLabelMap[N]:null)||officeLabelOverrides[ot]||ft[ot]||g.userData?.buildingName||g.userData?.name||ot,Jt=q[N]||"";return{id:ot,displayName:Qt,role:N,mesh:g,floor:Jt}}).filter(g=>g.id!==T.name&&g.displayName&&g.displayName!==C.displayName);C.children=I,ht.push(C)}Yt(ht)}catch(f){console.warn("Failed to create pins:",f)}y()}).catch(l=>{console.error("Error loading model:",l)}),de(a,i,()=>({children:[t.current,...r.children.filter(l=>l.renderOrder>=999)]}),(l,G,tt)=>{if(!t.current)return;if(l.userData?.isPin){const et=l.userData.role||null,$=l.userData.displayName||null;if(et){St(et,G,tt,$?{name:$}:null),nt(l.userData.targetMesh?.name||l.userData.targetMesh?.uuid);const b=window.__campus_requestRender;b&&b();return}}const V=Mt[l.name];if(!V)return;fetchInfoForRoleAndShowPopup(V,G,tt,null),fetchHappeningsForShowPopup(V,G,tt,null),nt(l.name||l.uuid);const X=window.__campus_requestRender;X&&X()});const jt=()=>{const l=e.clientWidth,G=e.clientHeight;i.aspect=l/G,i.updateProjectionMatrix(),a.setSize(l,G)};return window.addEventListener("resize",jt),y(),()=>{W&&clearTimeout(W);try{delete window.__campus_requestRender}catch{}window.removeEventListener("resize",jt),h.removeEventListener("change",y);try{a.domElement.remove()}catch{}h.dispose(),a.dispose(),document.body.style.overflow=Dt.current;try{delete window.__campus_camera,delete window.__campus_controls}catch{}a.domElement&&a.domElement.parentNode&&a.domElement.parentNode.removeChild(a.domElement);try{document.body.style.background=Et.current}catch{}}},[]);const Kt=e=>{if(!(!e||!e.mesh))try{Ft(e.mesh,{padding:Math.max(2,e.mesh.userData?.padding||2),animate:!0,frames:45},o,n,t),nt(e.mesh.name||e.id);const r=window.__campus_requestRender;r&&r()}catch(r){console.warn("Fly to pin failed:",r)}},Tt=e=>{if(e)try{if(e.role)St(e.role,window.innerWidth/2,window.innerHeight/2,{name:e.displayName}),nt(e.mesh?.name||e.id);else{const D=ve[e.id]||null;ut({id:e.id,name:D?.name||e.displayName||e.id,department:D?.department,description:D?.description,count:e.mesh?1:0,x:window.innerWidth/2,y:window.innerHeight/2}),nt(e.id)}const r=window.__campus_requestRender;r&&r()}catch(r){console.warn("Open info failed:",r)}},A="#003366",z="#FFB81C",Rt="#E8F0F7",Xt={position:d?"fixed":"absolute",left:d?"50%":10,top:d?"auto":10,bottom:d?20:"auto",transform:d?"translateX(-50%)":"none",zIndex:30,background:A,color:"white",border:"none",padding:"10px 14px",borderRadius:8,cursor:"pointer",fontWeight:600,boxShadow:"0 4px 10px rgba(0,0,0,0.2)",width:d?"calc(100vw - 2.5rem)":"auto",maxWidth:d?420:"auto"},qt={position:d?"fixed":"absolute",left:d?"50%":10,top:d?"auto":10,bottom:d?20:"auto",transform:d?"translateX(-50%)":"none",width:d?"calc(100vw - 2rem)":330,maxWidth:420,maxHeight:d?"60vh":"calc(100vh - 20px)",overflowY:"auto",padding:0,borderRadius:12,zIndex:20,background:"#ffffff",boxShadow:"0 10px 25px rgba(0, 51, 102, 0.15)",border:`2px solid ${A}`},Vt={position:"fixed",right:d?"auto":0,left:d?0:"auto",bottom:d?0:"auto",top:d?"auto":0,width:d?"100%":340,maxWidth:d?"100%":360,height:d?"auto":"100vh",maxHeight:d?"80vh":"100vh",background:"rgba(255,255,255,0.98)",boxShadow:d?"0 -8px 20px rgba(0,0,0,0.2)":"2px 0 16px rgba(0,0,0,0.10)",zIndex:60,padding:d?"16px 20px":24,overflowY:"auto",transition:"transform 0.3s ease",transform:H?d?"translateY(0)":"translateX(0)":d?"translateY(110%)":"translateX(110%)",pointerEvents:H?"auto":"none",borderRadius:d?"16px 16px 0 0":0,display:"flex",flexDirection:"column"};return u.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[u.jsx("div",{ref:s}),!Pt&&u.jsx("button",{onClick:()=>pt(!0),style:Xt,children:"Show Buildings"}),Pt&&u.jsxs("div",{style:qt,children:[u.jsx("div",{style:{background:`linear-gradient(135deg, ${A} 0%, ${A}dd 100%)`,padding:"16px 20px",borderRadius:"10px 10px 0 0",borderBottom:`3px solid ${z}`},children:u.jsxs("div",{style:{fontWeight:700,color:z,fontSize:16,letterSpacing:.5,display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[u.jsx(pe,{size:20,color:z}),"PSU BUILDINGS"]}),u.jsx("button",{onClick:()=>pt(!1),className:"text-gray-400 hover:text-gray-200 text-sm",children:"✕"})]})}),u.jsx("div",{style:{padding:"12px",display:"flex",flexDirection:"column",gap:10},children:xt.length===0?u.jsx("div",{style:{color:"#999",fontSize:13,textAlign:"center",padding:"20px 10px"},children:"Loading campus buildings..."}):xt.map(e=>{const r=!!zt[e.id],D=dt===(e.mesh?.name||e.id);return u.jsxs("div",{children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",background:D?Rt:"#f8f9fa",padding:"10px 12px",borderRadius:8,border:D?`2px solid ${A}`:"1px solid #e0e0e0",transition:"all 0.2s ease"},children:[u.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,flex:1},children:[e.children&&e.children.length>0&&u.jsx("button",{onClick:()=>$t(m=>({...m,[e.id]:!m[e.id]})),style:{border:"none",background:"transparent",cursor:"pointer",padding:4,fontSize:14,color:A,transition:"transform 0.2s",transform:r?"rotate(180deg)":"rotate(0)"},"aria-label":r?"Collapse":"Expand",children:"▾"}),!e.children||e.children.length===0&&u.jsx("div",{style:{width:24}}),u.jsx("div",{style:{flex:1},children:u.jsx("div",{style:{fontSize:13,fontWeight:600,color:A},children:e.displayName})})]}),u.jsx("div",{style:{display:"flex",gap:6},children:u.jsx("button",{onClick:()=>{Kt(e),Tt(e)},style:{background:A,color:"#fff",border:"none",padding:"6px 12px",borderRadius:6,cursor:"pointer",fontSize:12,fontWeight:600,transition:"all 0.2s ease",boxShadow:"0 2px 8px rgba(0, 51, 102, 0.2)"},onMouseEnter:m=>{m.target.style.background=z,m.target.style.color=A},onMouseLeave:m=>{m.target.style.background=A,m.target.style.color="#fff"},children:"View"})})]}),e.children&&e.children.length>0&&r&&u.jsx("div",{style:{marginTop:8,marginLeft:0,display:"flex",flexDirection:"column",gap:6,paddingLeft:12,borderLeft:`3px solid ${z}`},children:e.children&&e.children.length>0&&r&&u.jsx("div",{style:{marginTop:8,marginLeft:0,display:"flex",flexDirection:"column",gap:6,paddingLeft:12,borderLeft:`3px solid ${z}`},children:e.children.map(m=>u.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 10px",borderRadius:6,background:"#f0f4f8",border:"1px solid #d0d9e8",transition:"all 0.2s ease"},onMouseEnter:i=>{i.currentTarget.style.background=Rt,i.currentTarget.style.borderColor=z},onMouseLeave:i=>{i.currentTarget.style.background="#f0f4f8",i.currentTarget.style.borderColor="#d0d9e8"},children:[u.jsx("div",{style:{flex:1},children:u.jsxs("div",{style:{fontSize:12,color:"#333",fontWeight:500},children:[m.displayName,m.floor&&` - ${m.floor}`," "]})}),u.jsx("button",{onClick:()=>Tt(m),style:{background:z,color:A,border:"none",padding:"4px 8px",borderRadius:4,cursor:"pointer",fontSize:11,fontWeight:600,transition:"all 0.2s ease"},onMouseEnter:i=>{i.target.style.background=A,i.target.style.color=z},onMouseLeave:i=>{i.target.style.background=z,i.target.style.color=A},children:"Info"})]},m.id))})})]},e.id)})})]}),u.jsx("div",{style:Vt,children:H&&u.jsx(me,{popupInfo:H,onClose:()=>{ut(null),nt(null)},onFlyTo:()=>{if(!H)return;const e=_.current.find(r=>r.id===H.id);e?ue(e,o,n):H._mesh&&Ft(H._mesh,{padding:H._meshRadius||2,animate:!0,frames:45},o,n,t),ut(null)}})}),u.jsx("div",{"aria-label":"Camera controls",style:{position:"fixed",right:20,bottom:20,width:120,height:120,display:"flex",alignItems:"center",justifyContent:"center",zIndex:40,pointerEvents:"auto"}})]})}export{Ne as default};
