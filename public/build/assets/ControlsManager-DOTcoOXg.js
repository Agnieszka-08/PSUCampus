import{a as f,B,S as j,R as D}from"./three.core-BXuiQTOK.js";function k(r,c,v,q){const i=c.current,t=v.current;if(!i||!t||!r)return;const a=document.body.style.background,h=document.body.style.overflow;try{document.body.style.background="transparent",document.body.style.overflow="hidden"}catch{}const p=r.center.clone();p.y+=r.offsetY||2;const w=r.radius||5,d=i.fov*Math.PI/180,n=Math.abs(w/Math.sin(d/2))*1.2,x=new f;x.subVectors(i.position,t.target).normalize();const z=p.clone().add(x.multiplyScalar(n)),b=45;let m=0;const l=i.position.clone(),s=t.target.clone();function y(){m+=1;const u=Math.min(1,m/b);i.position.lerpVectors(l,z,u),t.target.lerpVectors(s,p,u),t.update();const g=window.__campus_requestRender;if(g&&g(),m<b)requestAnimationFrame(y);else try{document.body.style.background=a,document.body.style.overflow=h}catch{}}y()}function C(r,c={},v,q,i){const t=v.current,a=q.current;if(!t||!a||!r)return;const h=c.padding??2,p=c.animate??!0,w=c.frames??45,d=new B().setFromObject(r),n=d.getCenter(new f),z=d.getBoundingSphere(new j).radius||Math.max(d.getSize(new f).x,d.getSize(new f).y,d.getSize(new f).z)*.5||1,b=t.fov*Math.PI/180,m=Math.abs(z/Math.sin(b/2))+h;let l=new f;if(c.direction){const e=c.direction;e instanceof f?l.copy(e).normalize():Array.isArray(e)?l.set(e[0],e[1],e[2]).normalize():typeof e=="object"&&e.x!==void 0&&l.set(e.x,e.y,e.z).normalize()}else l.subVectors(t.position,a.target).normalize();let s=n.clone().add(l.clone().multiplyScalar(m));const y=new D,u=s.clone().sub(n).normalize();y.set(n.clone().add(u.clone().multiplyScalar(.01)),u);const g=i.current||r.parent,M=g?y.intersectObjects(g.children,!0):[];function R(e,o){let S=e;for(;S;){if(S===o)return!0;S=S.parent}return!1}if(M&&M.length){const e=M.find(o=>o.distance>.02&&!R(o.object,r));if(e){const o=e.distance-.5;o<m&&(s=n.clone().add(u.clone().multiplyScalar(Math.max(o,h))))}}if(t.near=Math.max(.01,Math.min(t.near,s.distanceTo(n)/100)),t.far=Math.max(t.far,s.distanceTo(n)*10),t.updateProjectionMatrix(),!p){t.position.copy(s),a.target.copy(n),a.update();const e=window.__campus_requestRender;e&&e();return}const T=t.position.clone(),V=a.target.clone();let _=0;function P(){_++;const e=Math.min(1,_/w);t.position.lerpVectors(T,s,e),a.target.lerpVectors(V,n,e),a.update();const o=window.__campus_requestRender;o&&o(),_<w&&requestAnimationFrame(P)}P()}export{C as flyToMeshSafe,k as flyToTargetSafe};
