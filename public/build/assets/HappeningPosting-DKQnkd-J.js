import{r as l,a as c,j as t}from"./app-B5oXa8-f.js";import{B as D}from"./BOA-CI3Y8i-u.js";import"./ApplicationLogo--c1FrT1-.js";import"./Dropdown-C-CKodni.js";import"./transition-CmycSXIp.js";import"./NavLink-BPH1jIQF.js";function T(){const[p,r]=l.useState([]),[n,g]=l.useState(null),[h,x]=l.useState(!1),[a,o]=l.useState({happenings:"",picture:null,video:null}),[d,u]=l.useState({picture:null,video:null});l.useEffect(()=>{c.get("/happenings/json").then(e=>{r(e.data.happenings||[])}).catch(e=>console.error("Failed to fetch happenings",e))},[]);const j=e=>{o({...a,[e.target.name]:e.target.value})},f=e=>{const{name:s,files:m}=e.target,i=m[0];o({...a,[s]:i}),u(S=>({...S,[s]:i?URL.createObjectURL(i):null}))},y=async()=>{const e=new FormData;e.append("happenings",a.happenings),a.picture&&e.append("picture",a.picture),a.video&&e.append("video",a.video);const s=await c.post("/happenings",e,{headers:{"Content-Type":"multipart/form-data"}});r([s.data,...p])},b=async()=>{const e=new FormData;e.append("_method","PUT"),e.append("happenings",a.happenings),a.picture&&e.append("picture",a.picture),a.video&&e.append("video",a.video);const s=await c.post(`/happenings/${n}`,e,{headers:{"Content-Type":"multipart/form-data"}});r(m=>m.map(i=>i.id===n?s.data:i))},w=async e=>{e.preventDefault(),x(!0);try{n?await b():await y(),v()}catch(s){console.error("Failed to submit form",s),alert("Something went wrong")}finally{x(!1)}},N=e=>{g(e.id),o({happenings:e.happenings,picture:null,video:null}),u({picture:e.picture||null,video:e.video||null})},C=async e=>{if(confirm("Are you sure you want to delete this happening?"))try{await c.delete(`/happenings/${e}`),r(p.filter(s=>s.id!==e))}catch(s){console.error("Delete failed",s),alert("Failed to delete happening.")}},v=()=>{g(null),o({happenings:"",picture:null,video:null}),u({picture:null,video:null})};return t.jsx(D,{children:t.jsxs("div",{className:"bg-white rounded-2xl shadow p-6 w-full",children:[t.jsx("h2",{className:"text-2xl font-semibold mb-6 text-gray-800",children:n?"Edit Happening":"Add Happening"}),t.jsxs("form",{onSubmit:w,encType:"multipart/form-data",className:"space-y-4",children:[t.jsx("input",{type:"text",placeholder:"Happenings",name:"happenings",value:a.happenings,onChange:j,className:"w-full border-gray-300 rounded-lg px-3 py-2",required:!0}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm text-gray-600",children:"Picture"}),t.jsx("input",{type:"file",accept:"image/*",name:"picture",onChange:f,className:"w-full"}),d.picture&&t.jsx("img",{src:d.picture,className:"mt-2 w-full rounded-lg max-h-48 object-cover"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm text-gray-600",children:"Video"}),t.jsx("input",{type:"file",accept:"video/*",name:"video",onChange:f,className:"w-full"}),d.video&&t.jsx("video",{src:d.video,controls:!0,className:"mt-2 w-full rounded-lg max-h-48"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{type:"submit",disabled:h,className:"bg-blue-600 text-white px-6 py-2 rounded-lg",children:h?"Saving...":n?"Update":"Add"}),n&&t.jsx("button",{type:"button",onClick:v,className:"bg-gray-300 px-6 py-2 rounded-lg",children:"Cancel"})]})]}),t.jsx("div",{className:"mt-6",children:p.map(e=>t.jsxs("div",{className:"flex justify-between bg-gray-100 p-3 rounded-lg mb-2",children:[t.jsxs("div",{className:"flex gap-4 items-center",children:[e.picture&&t.jsx("img",{src:e.picture,className:"w-16 h-16 object-cover rounded"}),e.video&&t.jsx("video",{src:e.video,className:"w-16 h-16 rounded",muted:!0,controls:!0}),t.jsx("span",{children:e.happenings})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>N(e),className:"text-blue-600",children:"Edit"}),t.jsx("button",{onClick:()=>C(e.id),className:"text-red-600",children:"Delete"})]})]},e.id))})]})})}export{T as default};
