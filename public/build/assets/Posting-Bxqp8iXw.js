import{r as o,a as m,j as t,H as P}from"./app-Dx9GpVgR.js";function D(){const[c,u]=o.useState([]),[s,r]=o.useState({picture:null,video:null}),[l,p]=o.useState(null),[h,f]=o.useState(!1),[n,d]=o.useState({name:"",information:"",happenings:"",picture:null,video:null});o.useEffect(()=>{m.get("/information/json").then(e=>{u(e.data.post||[])}).catch(e=>{console.error("Failed to fetch posts",e)})},[]);const x=e=>{d({...n,[e.target.name]:e.target.value})},b=e=>{const{name:a,files:g}=e.target,i=g[0];d({...n,[a]:i}),i&&a==="picture"&&r({...s,picture:URL.createObjectURL(i)}),i&&a==="video"&&r({...s,video:URL.createObjectURL(i)})},v=async()=>{const e=new FormData;e.append("name",n.name),e.append("information",n.information),e.append("happenings",n.happenings),n.picture&&e.append("picture",n.picture),n.video&&e.append("video",n.video);const a=await m.post("/info-buildings",e,{headers:{"Content-Type":"multipart/form-data"}});u([a.data,...c])},y=async()=>{const e=new FormData;e.append("_method","PUT"),e.append("name",n.name),e.append("information",n.information),e.append("happenings",n.happenings),n.picture&&e.append("picture",n.picture),n.video&&e.append("video",n.video);const a=await m.post(`/info-buildings/${l}`,e,{headers:{"Content-Type":"multipart/form-data"}});u(g=>g.map(i=>i.id===l?a.data:i))},j=async e=>{e.preventDefault(),f(!0);try{l?await y():await v(),d({name:"",information:"",happenings:"",picture:null,video:null}),r({picture:null,video:null}),p(null)}catch(a){console.error("Failed to submit form",a),alert("Something went wrong.")}finally{f(!1)}},w=e=>{d({name:e.name,information:e.information,happenings:e.happenings,picture:null,video:null}),r({picture:e.picture||null,video:e.video||null}),p(e.id)},N=async e=>{if(confirm("Are you sure you want to delete this post?"))try{await m.delete(`/info-buildings/${e}`),u(c.filter(a=>a.id!==e))}catch(a){console.error("Delete failed",a),alert("Failed to delete post")}},C=()=>{p(null),d({name:"",information:"",happenings:"",picture:null,video:null}),r({picture:null,video:null})};return t.jsxs(SAC,{children:[t.jsx(P,{title:"Dashboard"}),t.jsx("div",{className:"py-12 bg-gray-50 min-h-screen",children:t.jsxs("div",{className:"mx-auto max-w-6xl px-4 flex flex-col md:flex-row gap-8",children:[t.jsxs("div",{className:"bg-white rounded-2xl shadow p-6 md:w-1/2",children:[t.jsx("h2",{className:"text-2xl font-semibold mb-6 text-gray-800",children:l?"Edit Building Information":"Add Building Information"}),t.jsxs("form",{onSubmit:j,className:"space-y-4",encType:"multipart/form-data",children:[t.jsx("input",{type:"text",placeholder:"Name",value:n.name,onChange:x,name:"name",required:!0,className:"w-full border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 outline-none"}),t.jsx("textarea",{name:"information",value:n.information,onChange:x,placeholder:"Information",rows:"3",className:"w-full border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 outline-none"}),t.jsx("input",{type:"text",name:"happenings",value:n.happenings,onChange:x,placeholder:"Happenings",className:"w-full border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 outline-none"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Picture"}),t.jsx("input",{type:"file",name:"picture",accept:"image/*",onChange:b,className:"w-full text-sm border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 outline-none"}),s.picture&&t.jsx("img",{src:s.picture,alt:"Preview",className:"mt-2 w-full rounded-lg object-cover max-h-48"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Video"}),t.jsx("input",{type:"file",name:"video",accept:"video/*",onChange:b,className:"w-full text-sm border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 outline-none"}),s.video&&t.jsx("video",{src:s.video,controls:!0,className:"mt-2 w-full rounded-lg max-h-48"})]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{type:"submit",disabled:h,className:"bg-blue-600 text-white px-6 py-2 rounded-lg text-sm font-medium shadow-md disabled:opacity-50",children:h?"Saving...":l?"Update Post":"Add Post"}),l&&t.jsx("button",{type:"button",onClick:C,className:"bg-gray-300 text-gray-800 px-6 py-2 rounded-lg text-sm font-medium shadow-md",children:"Cancel"})]})]})]}),t.jsxs("div",{className:"bg-white rounded-2xl shadow p-6 md:w-1/2",children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Building Info Posts"}),c.length===0?t.jsx("p",{className:"text-gray-500 text-sm",children:"No posts found."}):t.jsx("div",{className:"space-y-6 overflow-y-auto max-h-[75vh] pr-2",children:c.map(e=>t.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-100 relative",children:[t.jsxs("div",{className:"absolute top-3 right-3 flex gap-2",children:[t.jsx("button",{onClick:()=>w(e),className:"text-sm text-blue-600 hover:text-blue-800",children:"âœï¸"}),t.jsx("button",{onClick:()=>N(e.id),className:"text-sm text-red-500 hover:text-red-700",children:"ğŸ—‘ï¸"})]}),t.jsx("h4",{className:"font-semibold text-lg text-gray-800",children:e.name}),t.jsx("p",{className:"text-gray-600 text-sm mt-1",children:e.information}),e.happenings&&t.jsxs("p",{className:"text-blue-500 text-xs mt-1",children:["ğŸ—ï¸ ",e.happenings]}),e.picture&&t.jsx("img",{src:e.picture,alt:"Building",className:"rounded-lg mt-3 w-full object-cover max-h-56"}),e.video&&t.jsx("video",{src:e.video,controls:!0,className:"rounded-lg mt-3 w-full max-h-56"})]},e.id))})]})]})})]})}export{D as default};
